//--------------------------------------------------------------------------------
//  entity system
//  エンティティシステム
//  实体系统
//
//  Autor  : 徐 文杰(Wenjie Xu)
//  Github : kodfreedom
//  Email  : kodfreedom@gmail.com
//--------------------------------------------------------------------------------
#pragma once
#include <unordered_map>
#include "../Utilities/singleton.h"

namespace KeepFortissimo
{
    class EntitySystem : public Singleton<EntitySystem>
    {
        friend class Singleton<EntitySystem>;
        friend class Entity;

    public:
        //--------------------------------------------------------------------------------
        //  エンティティ生成
        //  生成实体
        //--------------------------------------------------------------------------------
        Entity* CreateEntity(Entity* parent = nullptr);

        // test
        void PrepareRender();

    private:
        //--------------------------------------------------------------------------------
        //  constructor
        //  コンストラクタ
        //  构造函数
        //--------------------------------------------------------------------------------
        EntitySystem() {}

        //--------------------------------------------------------------------------------
        //  destructor
        //  デストラクタ
        //  析构函数
        //--------------------------------------------------------------------------------
        ~EntitySystem() {}

        //--------------------------------------------------------------------------------
        //  delete the copy constructor and operator
        //  コピ`コンストラクタとオペレ`タ`の削除
        //  删除复制用构造函数与等号
        //--------------------------------------------------------------------------------
        EntitySystem(EntitySystem const&) = delete;
        void operator=(EntitySystem const&) = delete;

        //--------------------------------------------------------------------------------
        //  initialize the instance
        //  初期化I理
        //  初始化
        //--------------------------------------------------------------------------------
        bool Initialize() override { return true; }

        //--------------------------------------------------------------------------------
        //  Uninit the instance
        //  インスタンスのK了I理
        //  终了处理
        //--------------------------------------------------------------------------------
        void Uninitialize() override;

        //--------------------------------------------------------------------------------
        //  ル`トエンティティ追加
        //  追加根实体
        //--------------------------------------------------------------------------------
        void AddRootEntity(Entity* entity);

        //--------------------------------------------------------------------------------
        //  ル`トエンティティ削除（エンティティの中身は削除しません）
        //  移除根实体
        //--------------------------------------------------------------------------------
        void RemoveRootEntity(Entity* entity);

        //--------------------------------------------------------------------------------
        //  variable / 涫 / 变量
        //--------------------------------------------------------------------------------
        uint32_t m_entity_id_end = 0;
        std::unordered_map<uint32_t, Entity*> m_root_entities;

#if _DEBUG
        //--------------------------------------------------------------------------------
        //  エンティティ追加
        //  追加实体
        //--------------------------------------------------------------------------------
        void AddEntity(Entity* entity);

        //--------------------------------------------------------------------------------
        //  エンティティ削除（エンティティの中身は削除しません）
        //  移除实体
        //--------------------------------------------------------------------------------
        void RemoveEntity(Entity* entity);

        //--------------------------------------------------------------------------------
        //  variable / 涫 / 变量
        //--------------------------------------------------------------------------------
        std::unordered_map<uint32_t, Entity*> m_entities;
#endif
    };
}